<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>One Page Wonder - Start Bootstrap Template</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/one-page-wonder.min.css" rel="stylesheet">

  <style>
    .rounded-circle {
      margin-bottom: 10px;
    }
    .imageblock { 
      max-width: 100%; height: auto; border:1px solid #eaeaea; padding: 0px; 
    }
  </style>

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
    <div class="container">
      <a class="navbar-brand" href="/index.html" style="font-family: Jal_Onuel; font-size: 25px;">유리온</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
              <a class="nav-link" onclick="fnMove('1')" type="button" >이달의 분리수거왕</a>          
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="fnMove('2')" >올바른 분리수거 방법</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="login_btn" href="/login.html">로그인</a>
            <a class="nav-link" id="logout_btn">로그아웃</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- background-image: url(./img/배경4.jpg); -->
  <!-- background:linear-gradient(0deg,#F5DBCB 0,#17B890 100%) -->
  <header class="masthead text-center text-white" style="background:linear-gradient(0deg,#fccdae 0,#00bfb5 100%)">
    <div class="masthead-content">
      <div class="container">
        <h1 class="masthead-heading mb-0" id="bottle_amount_ani" style="font-size: 180px;"></h1>
        <h1 id="before_login_header">유리온에서는 <br>총 <span id="bottle_amount" style="text-decoration:underline"></span>개의 유리병을 수거했습니다</h1>

        <!-- <h1 id="before_login_header">이번 달 유리온에서는,<br><span class="display-1" id="bottle_amount"></span>개의 유리병이<br> 분리수거 되었습니다.</h1> -->
        <h1 class="masthead-heading mb-0" id="place_username"></h1>
        <h2 class="masthead-subheading mb-0" id="place_point"></h2>
        <a href="./recycle_list.html" class="btn btn-primary btn-xl rounded-pill mt-5" id="pointCheck_btn">포인트 내역 조회</a>
      </div>
    </div>
  </header>

<section id="move1">
  <h2 class="display-4 text-center" style="padding-top: 5.5rem;">이달의 분리수거왕</h2>
  <section>
    <div class="container" id="award-section">
      <div class="row align-items-center">
        <div class="col-lg-6 order-lg-2">
          <div class="p-5" id="award_wrap">
            <div class="award_items">
              <img class="img-fluid rounded-circle imageblock" src="img/01.jpg" alt="">
              <h2 class="display-6 text-center" id="award_name1"></h2>
              <h4 class="display-6 text-center" id="award_points1"></h4>
              <p class="text-center">우리에게 허락된 외출은<br/>분리수거 뿐.</p>
            </div>
            <div class="award_items">
              <img class="img-fluid rounded-circle imageblock" src="img/02.jpg" alt="">
              <h2 class="display-6 text-center" id="award_name2"></h2>
              <h4 class="display-6 text-center" id="award_points2"></h4>
              <p class="text-center">아름다운 밤이에요~</p>
            </div>
            <div class="award_items">
              <img class="img-fluid rounded-circle imageblock" src="img/03.jpg" alt="">
              <h2 class="display-6 text-center" id="award_name3"></h2>
              <h4 class="display-6 text-center" id="award_points3"></h4>
              <p class="text-center">분리수거는 유리온!</p>
            </div>
          </div>
        </div>  
      </div>
    </div>
  </section>

  <section id="move2">
    <div class="container">
      <h2 class="display-4 text-center">올바른 분리수거 방법</h2>
      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod aliquid, mollitia odio veniam sit iste esse assumenda amet aperiam exercitationem, ea animi blanditiis recusandae! Ratione voluptatum molestiae adipisci, beatae obcaecati.</p>
    </div>
  </section>
</section>


  <!-- Footer -->
  <footer class="py-5 bg-black">
    <div class="container">
      <p class="m-0 text-center text-white small">Copyright &copy; Your Website 2020</p>
    </div>
    <!-- /.container -->
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

</html>

<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript">
  var API_URL = "https://taz84axy7a.execute-api.us-east-1.amazonaws.com/dev/index";

  var logout_btn = document.getElementById("logout_btn");
  var login_btn = document.getElementById("login_btn");
  var username_display = document.getElementById("place_username");
  var pointCheck_btn = document.getElementById("pointCheck_btn");

  $(document).ready(function () {
      $.ajax({
        type: 'POST',   //API Gateway를 만들때, POST로 만들었으므로 타입을 POST로 지정
        error: function(xhr, status, error){
          console.log(error);
        },
        url: API_URL,
        async:false,
        // data: JSON.stringify({
        // 	"userid": $('#userId').val(),
        // 	"password": $('#password').val()
        // }),
        // contentType: "application/json",
        //API Gateway 설정에서 매핑 템플릿을 설정하였으므로 그 이름과 동일하게 씀

        success: function (data) {
          var awards = data['kings'];
          $('#award_name1').text(awards[0][0]+ ' 님');
          $('#award_name2').text(awards[1][0]+ ' 님');
          $('#award_name3').text(awards[2][0]+ ' 님');
          $('#award_points1').text(awards[0][1]+ 'p');
          $('#award_points2').text(awards[1][1]+ 'p');
          $('#award_points3').text(awards[2][1]+ 'p');

          data_amount = data['data_amount'];
          $('#bottle_amount').text(data_amount[0]);
        }
      });
      const obj = document.getElementById("bottle_amount_ani");
      animateValue(obj, 0, data_amount, 2000);
		});

  $('#logout_btn').on('click', function () {
    sessionStorage.clear();
    location.reload();
    alert("로그아웃 완료");
  });

  (function () {

    if (sessionStorage.getItem('userid')){
      // 로그인 된 상태
      // 로그인/아웃 버튼 교체, 닉네임 표시
      logout_btn.style.display = "block";
      login_btn.style.display = "none";
      pointCheck_btn.style.display = "inline-block";
      username_display.innerHTML = sessionStorage.getItem('username');
    }
    else {
      before_login_header.style.display = "block";
    };
  }());

  function fnMove(seq){
          var offset = $("#move" + seq).offset();
          $('html, body').animate({scrollTop : offset.top}, 400);
      }

  function animateValue(obj, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);
      obj.innerHTML = Math.floor(progress * (end - start) + start);
      if (progress < 1) {
        window.requestAnimationFrame(step);
      }
    };
    window.requestAnimationFrame(step);
  }
  

</script>